<Project
    xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Target Name="CopyEcsToProject" BeforeTargets="Build">
        <Message Text="Copying .ecs template(s) to the project..." Importance="high" />
        <Message Text="Targets dir: $(MSBuildThisFileDirectory)"   Importance="high"/>
        <Message Text="Project dir: $(MSBuildProjectDirectory)"    Importance="high"/>
        <Copy 
          SourceFiles="$(MSBuildThisFileDirectory)..\content\CompileTimeDI.ecs" 
          DestinationFiles="$(MSBuildProjectDirectory)\CompileTimeDI.ecs" 
          SkipUnchangedFiles="true"/>
        <Copy 
          SourceFiles="$(MSBuildThisFileDirectory)..\content\ServiceRegistrations.ecs.include" 
          DestinationFiles="$(MSBuildProjectDirectory)\ServiceRegistrations.ecs.include" 
          SkipUnchangedFiles="true"/>
        <PropertyGroup>
            <ProjectDirEscaped>$(MSBuildProjectDirectory.Replace('\', '___'))</ProjectDirEscaped>
        </PropertyGroup>
        <Exec WorkingDirectory="$(MSBuildProjectDirectory)" 
            Command="dotnet lemp %(EcsFile.Identity) --outext=.Generated.cs --o-indent-spaces=4 --set:ProjectDir=@&quot;$(ProjectDirEscaped)&quot;" />
    </Target>
    <ItemGroup>
        <EcsFile Include="**\*.ecs" />
        <Generated Include="**\*.Generated.cs" />
        <None Include=".\ServiceRegistrations.ecs.include" />
    </ItemGroup>
</Project>